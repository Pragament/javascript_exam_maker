<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exam Question</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- Add DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
</head>
<body>
  <header>
    <h1>Exam Question</h1>
  </header>

  <main>
    <div id="assigned-questions-section" class="card">
      <h2>Your Assigned Questions</h2>
      <div id="assigned-questions-container" class="cards-container">
        <!-- Assigned questions will be loaded here -->
      </div>
    </div>

    <div id="question-selection" class="card">
      <h2>Available Questions</h2>
      <div id="questions-container" class="cards-container">
        <!-- Questions will be loaded here -->
      </div>
    </div>

    <div id="question-view" class="card" style="display: none;">
      <h2>Question Details</h2>
      <div id="question-details">
        <!-- Question details will be loaded here -->
      </div>
      <div id="answer-submit-section" style="margin-top: 24px;">
        <h3>Submit Your Answer</h3>
        <textarea id="answer-text" rows="5" placeholder="Type your answer here..." style="width:100%;"></textarea>
        <div style="margin: 8px 0;">
          <label for="answer-file">Or upload CSV file:</label>
          <input type="file" id="answer-file" accept=".csv,.xlsx,.xls ">
        </div>
        <button class="btn-primary" onclick="submitAnswer()">Submit Answer</button>
        <div id="answer-submit-status"></div>
      </div>
    </div>
  </main>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="js/firebase-config.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="js/student-view.js"></script>
  <script>
  window.addEventListener("DOMContentLoaded", () => {
    const observer = new MutationObserver(() => {
      document.querySelectorAll('button').forEach((btn) => {
        if (btn.textContent.trim() === 'Select This Question' && !btn.dataset.bound) {
          btn.dataset.bound = "true";
          btn.addEventListener('click', () => {
            window.postMessage({ type: 'START_SCREEN_RECORDING' }, '*');
          });
        }
      });
    });

    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  });

  window.addEventListener("message", function(event) {
    if (event.data.type === "RECORDING_STOPPED") {
      alert("Recording saved. Please select the next question.");
      const params = new URLSearchParams(window.location.search);
      const examId = params.get("examId");
      if (examId) {
        window.location.href = `student.html?examId=${examId}&msg=recording_saved`;
      } else {
        window.location.href = "student.html?msg=recording_saved";
      }
    }
  });
</script>


</body>
</html>